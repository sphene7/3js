<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Demo 2 - Instanced Christmas Tree</title>
  <style>
    body { margin: 0; overflow: hidden; background: #050810; }
  </style>
</head>
<body>
<script type="module">
import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

let scene, camera, renderer;
let tree;

init();
animate();

function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(
    60,
    window.innerWidth / window.innerHeight,
    0.1,
    100
  );
  camera.position.set(0, 5, 15);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const light = new THREE.PointLight(0xffd700, 10);
  light.position.set(5, 10, 5);
  scene.add(light);

  createTree();
}

function createTree() {
  const COUNT = 800;
  const HEIGHT = 8;

//   const geometry = new THREE.SphereGeometry(0.12, 12, 12);
  const geometry = new THREE.BoxGeometry(0.15, 0.15, 0.15)
  const material = new THREE.MeshStandardMaterial({
    color: 0x00ff66,
    metalness: 0.6,
    roughness: 0.3
  });

  tree = new THREE.InstancedMesh(geometry, material, COUNT);

  const dummy = new THREE.Object3D();

  for (let i = 0; i < COUNT; i++) {
    // ðŸŒ² æ ¸å¿ƒï¼šåœ†é”¥ä½“åˆ†å¸ƒå…¬å¼
    // const y = Math.random() * HEIGHT;
    const y = Math.random() * HEIGHT * HEIGHT;

    const radius = (1 - y / HEIGHT) * 3;
    // const radius = Math.random() * 3;

    const angle = Math.random() * Math.PI * 2;
    const x = Math.cos(angle) * radius;
    const z = Math.sin(angle) * radius;
    

    dummy.position.set(x, y, z);
    dummy.scale.setScalar(0.8 + Math.random() * 0.5);
    dummy.updateMatrix();

    tree.setMatrixAt(i, dummy.matrix);
  }

  scene.add(tree);
}

function animate() {
  requestAnimationFrame(animate);
  tree.rotation.y += 0.003;
  renderer.render(scene, camera);
}
</script>
</body>
</html>
